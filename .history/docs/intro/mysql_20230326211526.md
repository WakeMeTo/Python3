





# 数据库相关概念

| 名称           | 全称                                                     | 简称                             |
| -------------- | -------------------------------------------------------- | -------------------------------- |
| 数据库         | 存储数据的仓库，数据是有组织的进行存储                   | DataBase(DB)                     |
| 数据库管理系统 | 操作和管理数据库的大型软件                               | DataBase Management System(DBMS) |
| SQL            | 操作关系型数据库的编程语言，定义一套操作型数据库统一标准 | Structured Query Language(SQL)   |



>  总结：程序员通过编写SQL语句操作数据库管理系统来管理数据库



关系型数据库排名：https://db-engines.com/en/



MySQL是关系型数据库，那么什么是关系型数据库呢？

关系型数据库（RDBNS）：

注意：二维是指长、宽

> 概念：建立在关系模型基础上，由多张相互连接的二维表组成的数据库。
>
> 特点：
>
> ​		●	使用表储存数据，格式统一，便于维护
>
> ​		●	使用SQL语言操作，标准统一，使用方便

扩展：有关系型数据库，自然也会有非关系型数据库。而NoSQL数据库（非关系型数据库）是用于存储和检索数据的非关系数据库系统。



# MySQL安装、卸载和启动



## 版本

> MySQL官方提供了两种不同的的版本：
>
> ●	社区版（MySQL Community Server）
>
> ​		免费，MySQL不提供任何技术支持
>
> ●	商业版（MySQL Enterprise Edition）
>
> ​	    收费，可以试用30天，官方提供技术支持



命令行查看MySQL的版本号`mysql -V`



MySQL官网：https://www.mysql.com/cn/







## MySQL安装-Windows版

### 1. 安装

**1). 双击官方下来的安装包文件**

![image-20210916184347938](D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184347938.png) 



**2). 根据安装提示进行安装**

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184532212.png" alt="image-20210916184532212" style="zoom:67%;" /> 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184603712.png" alt="image-20210916184603712" style="zoom: 74%;" /> 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184634094.png" alt="image-20210916184634094" style="zoom:70%;" /> 



安装MySQL的相关组件，这个过程可能需要耗时几分钟，耐心等待。

![image-20210916184700031](D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184700031.png) 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184709776.png" alt="image-20210916184709776" style="zoom:96%;" /> 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184743524.png" alt="image-20210916184743524" style="zoom:80%;" /> 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184759021.png" alt="image-20210916184759021" style="zoom:80%;" /> 



==输入MySQL中root用户的密码,一定记得记住该密码==

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184814656.png" alt="image-20210916184814656" style="zoom:85%;" /> 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184832159.png" alt="image-20210916184832159" style="zoom:85%;" /> 

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210916184851013.png" alt="image-20210916184851013" style="zoom:87%;" /> 





### 2. 配置

安装好MySQL之后，还需要配置环境变量，这样才可以在任何目录下连接MySQL。

1). 在此电脑上，右键选择属性

![image-20210918161550977](D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210918161550977.png) 



2). 点击左侧的 "高级系统设置"，选择环境变量

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210918161646433.png" alt="image-20210918161646433" style="zoom:80%;" /> 



3). 找到 Path 系统变量, 点击 "编辑"

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210918161803544.png" alt="image-20210918161803544" style="zoom:80%;" /> 



4). 选择 "新建" , 将MySQL Server的安装目录下的bin目录添加到环境变量

<img src="D:\2023\heima_JAVA\2022_heima_MySQL数据库\基础篇\MySQL安装文档-Windows\assets\image-20210918161954696.png" alt="image-20210918161954696" style="zoom:80%;" /> 











## MySQL卸载文档-Windows版

### 1. 停止MySQL服务

win+R 打开运行，输入 services.msc 点击 "确定" 调出系统服务。

![image-20220209203115052](D:/2023/heima_JAVA/2022_heima_MySQL数据库/基础篇/MySQL卸载文档-Windows/assets/image-20220209203115052.png) 

![image-20220209203253220](D:/2023/heima_JAVA/2022_heima_MySQL数据库/基础篇/MySQL卸载文档-Windows/assets/image-20220209203253220.png) 





### 2. 卸载MySQL相关组件

打开控制面板 ---> 卸载程序 ---> 卸载MySQL相关所有组件

![image-20220209203345746](D:/2023/heima_JAVA/2022_heima_MySQL数据库/基础篇/MySQL卸载文档-Windows/assets/image-20220209203345746.png) 

![image-20220209203431405](D:/2023/heima_JAVA/2022_heima_MySQL数据库/基础篇/MySQL卸载文档-Windows/assets/image-20220209203431405.png) 



### 3. 删除MySQL安装目录

![image-20220209205157019](D:/2023/heima_JAVA/2022_heima_MySQL数据库/基础篇/MySQL卸载文档-Windows/assets/image-20220209205157019.png) 





### 4. 删除MySQL数据目录

数据存放目录是在 C:\ProgramData\MySQL，直接将该文件夹删除。

![image-20220209205401563](D:/2023/heima_JAVA/2022_heima_MySQL数据库/基础篇/MySQL卸载文档-Windows/assets/image-20220209205401563.png) 





### 5. 再次打开服务，查看是否有MySQL卸载残留

如果已将MySQL卸载，但是通过任务管理器--->服务，查看到MySQL服务仍然残留在系统服务里。

解决办法：

​	以管理员方式运行cmd命令行，输入以下命令：

​	sc delete 服务名称（如MySQL80）

这样可以实现删除服务。



## 启动



方法1：

> 命令行启动 services.msc
>
> 找到MySQL手动处理



方法2：

> 命令行启动：net start mysql80
>
> 命令行停止：net stop mysql80
>
> 注意：要以管理员身份运行





# MySQL连接



方法1：

> MySQL自带的：MySQL 8.0 Command Client -Unicode



方法2：

127.0.0.1:	是ip，127.0.0.1是主机环回地址。主机环回指的是，地址为127.0.0.1的数据包不离开计算机（主机）发送，不发送到本地网络或internet，它只是在自身上“环回”，发送数据包的计算机成为收件人。

3306：是MySQL默认端口号

root:	MySQL默认的超级管理员账户

> 命令行启动：mysql [-h 127.0.0.1] [-P 3306] -u root -p
>
> 注意：[]代表可以省略，使用这种方式时，需要配置PATH环境变量



MySQL的PATH路径：C:\Program Files\MySQL\MySQL Server 8.0\bin







# SQL通用语法和分类



## SQL通用语法

> ●	SQL语句可以单行注释或多行注释，以分号结尾。
>
> ●	SQL语句可以使用空格/缩进来增强语句的可读性
>
> ●	MySQL数据库的SQL语句不区分大小写，关键字建议使用大小写
>
> ●	注释：
>
> ​				1.单行注释：-- 注释内容 或 # 注释内容
>
> ​				2.多行注释: /**/



## SQL分类

| 分类 | 全称                       | 说明                                                     |
| ---- | -------------------------- | -------------------------------------------------------- |
| DDL  | Data Definition Language   | 数据库定义语言，用来定义数据库对象（数据库、表、字段）   |
| DML  | Data Manipulation Language | 数据库操作语言，用来对数据库表中的数据进行`增删改查`     |
| DQL  | Data Query Language        | 数据库查询语言，用来查询数据库中表中的记录               |
| DCL  | Data Control Language      | 数据库控制语言，用来创建数据库用户、控制数据库的访问权限 |

总结：

> DDL:	是用来定义数据库对象的。
>
> DML:	是用来操作数据库中的数据进行增删改查。
>
> DQL:	是用来查询数据库中存储的数据。
>
> DCL：  是用来创建数据库的用户、和用户访问数据库的权限



# MySQL数据类型



## 数值类型

| 类型         | 大小                                     | 范围（有符号）signed                                         | 范围（无符号）unsigned                                       | 用途            |
| :----------- | :--------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- | :-------------- |
| TINYINT      | 1 Bytes                                  | (-128，127)                                                  | (0，255)                                                     | 小整数值        |
| SMALLINT     | 2 Bytes                                  | (-32 768，32 767)                                            | (0，65 535)                                                  | 大整数值        |
| MEDIUMINT    | 3 Bytes                                  | (-8 388 608，8 388 607)                                      | (0，16 777 215)                                              | 大整数值        |
| INT或INTEGER | 4 Bytes                                  | (-2 147 483 648，2 147 483 647)                              | (0，4 294 967 295)                                           | 大整数值        |
| BIGINT       | 8 Bytes                                  | (-9,223,372,036,854,775,808，9 223 372 036 854 775 807)      | (0，18 446 744 073 709 551 615)                              | 极大整数值      |
| FLOAT        | 4 Bytes                                  | (-3.402 823 466 E+38，-1.175 494 351 E-38)，0，(1.175 494 351 E-38，3.402 823 466 351 E+38) | 0，(1.175 494 351 E-38，3.402 823 466 E+38)                  | 单精度 浮点数值 |
| DOUBLE       | 8 Bytes                                  | (-1.797 693 134 862 315 7 E+308，-2.225 073 858 507 201 4 E-308)，0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 0，(2.225 073 858 507 201 4 E-308，1.797 693 134 862 315 7 E+308) | 双精度 浮点数值 |
| DECIMAL      | 对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2 | 依赖于M和D的值                                               | 依赖于M和D的值                                               | 小数值          |



## 日期和时间类型



| 类型      | 大小 ( bytes) | 范围                                                         | 格式                | 用途                     |
| :-------- | :------------ | :----------------------------------------------------------- | :------------------ | :----------------------- |
| DATE      | 3             | 1000-01-01/9999-12-31                                        | YYYY-MM-DD          | 日期值                   |
| TIME      | 3             | '-838:59:59'/'838:59:59'                                     | HH:MM:SS            | 时间值或持续时间         |
| YEAR      | 1             | 1901/2155                                                    | YYYY                | 年份值                   |
| DATETIME  | 8             | '1000-01-01 00:00:00' 到 '9999-12-31 23:59:59'               | YYYY-MM-DD hh:mm:ss | 混合日期和时间值         |
| TIMESTAMP | 4             | '1970-01-01 00:00:01' UTC 到 '2038-01-19 03:14:07' UTC结束时间是第 **2147483647** 秒，北京时间 **2038-1-19 11:14:07**，格林尼治时间 2038年1月19日 凌晨 03:14:07 | YYYY-MM-DD hh:mm:ss | 混合日期和时间值，时间戳 |



## 字符串类型



| 类型       | 大小                  | 用途                            |
| :--------- | :-------------------- | :------------------------------ |
| CHAR       | 0-255 bytes           | 定长字符串                      |
| VARCHAR    | 0-65535 bytes         | 变长字符串                      |
| TINYBLOB   | 0-255 bytes           | 不超过 255 个字符的二进制字符串 |
| TINYTEXT   | 0-255 bytes           | 短文本字符串                    |
| BLOB       | 0-65 535 bytes        | 二进制形式的长文本数据          |
| TEXT       | 0-65 535 bytes        | 长文本数据                      |
| MEDIUMBLOB | 0-16 777 215 bytes    | 二进制形式的中等长度文本数据    |
| MEDIUMTEXT | 0-16 777 215 bytes    | 中等长度文本数据                |
| LONGBLOB   | 0-4 294 967 295 bytes | 二进制形式的极大文本数据        |
| LONGTEXT   | 0-4 294 967 295 bytes | 极大文本数据                    |

> 注意：
>
> ​		定长字符串和变长字符串的区别
>
> ​		定长字符串：char(10),当指定储存的长度为10时，你存入的数据如果长度为10则刚好占满，你存入的数据如果长度是1，也就是		说你只存入了一个数据，虽然你只存入了一个数据，但是也会占满10个内存空间，1个位存入的数据，剩下的9个为空。
>
> ​		变长字符串：varchar(10)当指定储存的长度为10时，你存入的数据如果长度为10则刚好占满，你存入的数据如果长度是1，也		就是说你只存入了一个数据，这时候你存入的数据只占1个内存长度，还可以剩9个内存长度。
>
> ​		char 比较于 varchar,	性能比varchar要好



# DDL：是用来定义数据库对象的



## 数据库操作

### `查询数据库`

注意：[]	里的内容是可选的

`查询所有数据库`

> show databases;

`查询当前数据库`

> select database();



### `创建数据库`

> create database [if not exists] 数据库名 [default charset 字符集] [collate 排序规则]; 



### `删除数据库`

> drop database[if exists]数据库名;



### `使用数据库`

> use 数据库名；



### 总结

| 分类       | 语法                                                         |
| ---------- | ------------------------------------------------------------ |
| 创建数据库 | create database [if not exists] 数据库名 [default charset 字符集] [collate 排序规则]; |
| 使用数据库 | use 数据库名；                                               |
| 查询数据库 | show databases;（查询所有数据库）                            |
|            | select database(); （查询当前数据库）                        |
| 删除数据库 | drop database[if exists]数据库名;                            |



## 数据库中表的操作



### `创建表`

> create table 表名(
>
> ​		字段1 字段1数据类型[comment 字段1的注释],
>
> ​		字段2 字段2数据类型[comment 字段2的注释],
>
> ​		字段3 字段3数据类型[comment 字段3的注释]
>
> )[comment 表注释];





### `查询表`

> 查询当前数据库所有表
>
> show tables;
>
> 查询表结构
>
> desc 表名;
>
> 查询指定表的建表语句
>
> show create table 表名;



### `修改表`

> 添加字段
>
> alter table 表名 add 字段名 数据类型(长度) [comment 注释] [约束];
>
> 
>
> 修改数据类型
>
> alter table 表名 modify 字段名 新数据类型(长度);
>
> 
>
> 修改字段名和字段类型
>
> alter table 表名 change 旧字段名 新字段名 数据类型(长度)[comment 注释] [约束];
>
> 修改表名
>
> alter table 表名 rename to 新表名;



### `删除表`

> 删除字段
>
> alter table 表名 drop 字段名;
>
> 
>
> 删除表
>
> drop table[if exists] 表名;
>
> 
>
> 删除指定表，并重写创建该表
>
> truncate table 表名;



### 总结

| 分类   | 语法                                                         |
| ------ | ------------------------------------------------------------ |
| 创建表 | create table 表名(字段1 字段1数据类型[comment 字段1的注释],字段2 字段2数据类型[comment 字段2的注释])[comment 表注释]; |
| 查询表 | show tables;（查询当前数据库所有表）                         |
|        | desc 表名;（查询表结构）                                     |
|        | show create table 表名;（查询指定表的建表语句）              |
| 修改表 | alter table 表名 modify 字段名 新数据类型(长度);（修改数据类型） |
|        | alter table 表名 change 旧字段名 新字段名 数据类型(长度)[comment 注释] [约束];（修改字段名和字段类型） |
|        | alter table 表名 rename to 新表名;（修改表名）               |
| 删除表 | drop table[if exists] 表名;（删除表）                        |
|        | truncate table 表名;（删除指定表，并重写创建该表）           |
| 添加   | alter table 表名 add 字段名 数据类型(长度) [comment 注释] [约束];(添加字段) |





# DML：是用来操作数据库中的数据进行增删改查



## `添加数据`

> 给指定字段添加数据
>
> insert into 表名 (字段名1,字段名2,...) values(值1，值2,...);
>
> 给全部字段添加数据
>
> insert into 表格 values(值1，值2,...);
>
> 批量添加数据
>
> insert into 表名 (字段名1,字段名2,...) values(值1，值2,...),(值1，值2,...);
>
> insert into 表名 values(值1，值2,...),(值1，值2,...),(值1，值2,...);

注意：

​			●	插入数据时，指定的字段顺序需要与值的顺序是一一对应的。

​			●	字符串和日期型数据应该包含在引号中。

​			●	插入的数据大小，应该在字段的规定范围内。



## `修改数据`

> update 表名 set 字段名1=值1,字段名2=值2,...[where 条件];



## `删除数据`

> delete from 表名 [where 条件]



## 总结

| 分类     | 语法                                                         |
| -------- | ------------------------------------------------------------ |
| 添加数据 | insert into 表名 (字段名1,字段名2,...) values(值1，值2,...);（给指定字段添加数据） |
|          | insert into 表格 values(值1，值2,...);（给全部字段添加数据） |
|          | insert into 表名 (字段名1,字段名2,...) values(值1，值2,...),(值1，值2,...);（批量添加数据） |
|          | insert into 表名 values(值1，值2,...),(值1，值2,...),(值1，值2,...);（批量添加数据） |
| 修改数据 | update 表名 set 字段名1=值1,字段名2=值2,...[where 条件];     |
| 删除数据 | delete from 表名 [where 条件]                                |



# DQL：是用来查询数据库中存储的数据。



查询关键字:	`select`



## `语法：`

编写顺序																												执行顺序

> select																												from
>
> ​			字段列表																											表名列表
>
> from																												  where
>
> ​			表名列表																											 条件列表
>
> where																												group by
>
> ​			条件列表																											  分组字段列表
>
> group by																										   having
>
> ​			分组字段列表																										分组后条件列表														
>
> having																												select
>
> ​			分组后条件列表																								    字段列表
>
> order by																											 order by
>
> ​			排序字段列表																										排序字段列表
>
> limit																													limit
>
> ​			分页参数																												分页参数



where与having的区别

●	执行时间不同：where是分组之前进行过滤，不满足where条件，不参与分组；而having是分组之后对结果进行过滤。

●	判断条件不同：where不能对聚合函数进行判断，而having可以。



注意：

​			执行顺序：where>聚合函数>having。

​			分组之后，查询的字段一般为聚合函数和分组字段，查询其他字段无任何意义。





## `基本查询`

●	查询多个字段

> select 字段1，字段2，字段3,...from 表名;
>
> select * from 表名;



●	设置别名

select 字段1 [as 别名1],  字段2 [as 别名2]...from 表名；



●	去除重复记录

> select distinct 字段列表 from 表名;



## `条件查询`



### `语法：`

> select 字段列表 from 表名 where 条件列表;



### `条件：`

| 比较运算符       | 功能                                     |
| ---------------- | ---------------------------------------- |
| >                | 大于                                     |
| >=               | 大于等于                                 |
| <                | 小于                                     |
| <=               | 小于等于                                 |
| =                | 等于                                     |
| <> 或 !=         | 不等于                                   |
| between...and... | 在某个范围之内(含最小，最大值)           |
| in(...)          | 在in之后的列表中的值，多选一             |
| like 占位符      | 模糊匹配(_匹配单个字符，%匹配任意个字符) |
| is null          | 是null                                   |



| 逻辑运算符 | 功能                       |
| ---------- | -------------------------- |
| and 或 &&  | 并且(多个条件同时成立)     |
| or 或 \|\| | 或者(多个条件任意一个成立) |
| not 或 ！  | 非，不是                   |



## `聚合函数`



什么是聚合函数？

> 将一列数据作为一个整体，进行纵向计算。



常见的聚合函数

| 函数  | 功能     |
| ----- | -------- |
| count | 统计数量 |
| max   | 最大值   |
| min   | 最小值   |
| avg   | 平均值   |
| sum   | 求和     |



语法：

> select 聚合函数(字段列表) from 表名；



注意：null值不参与所有聚合函数运算。







## `分组查询`



语法：

> select 字段列表 from 表名 [where 条件] group by 分组字段名 [having 分组后过滤条件];





## `排序查询`



语法：

> select 字段列表 from 表名 order by 字段1 排序方式1，字段2 排序方法2;



排序方法

●	asc:	升序(默认值)

●	desc:	降序



注意：如果是多字段排序，当第一个字段值相同时，才会根据第二个字段进行排序。







## `分页查询`



语法：

> select 字段列表 from 表名 limit 起始索引,查询记录数;



注意：

​			●	起始索引从0开始，起始索引=（查询列表-1)*每页显示记录数。

​		    ●	分页查询是数据库的方言，不同的数据库有不同的实现，MySQL中是limit。

​			●	如果查询的是等一页数据，起始索引可以省略，直接简写为 limit 10。











# DQL：是用来创建数据库的用户、和用户访问数据库的权限



## `用户管理`

查询用户

> use mysql;
>
> select * from user;



创建用户

> create user '用户名'@'主机名' identified by '密码';



修改用户密码

> alter user '用户名'@'主机名' identified with mysql_native_password by '新密码';



删除用户

> drop user '用户名'@'主机名';



注意：

​			●	主机名可以使用%通配。

​			●	这类SQL开发人员操作的比较少，主要是DBA（Database Administrator 数据管理员）使用。







## `权限控制`

MySQL常用的权限

| 权限               | 说明               |
| ------------------ | ------------------ |
| ALL,ALL PRIVILEGES | 所有权限           |
| SELECT             | 查询数据权限       |
| INSERT             | 插入数据权限       |
| UPDATE             | 修改数据权限       |
| DELETE             | 删除数据权限       |
| ALTER              | 修改表权限         |
| DROP               | 删除数据库/表/视图 |
| CREATE             | 创建数据库/表      |



查询权限

> show grants for '用户名'@'主机名';



授予权限

> grant 权限列表 on 数据库名.表名 to '用户名'@'主机名';



撤销权限

> revoke 权限列表 on 数据库名.表名 from '用户名'@'主机名';



注意：

​			●	多个权限之间，使用逗号分隔

​		    ●	授权时，数据库名和表名可以使用*进行通配，代表所有。







# 函数

什么是函数：

> 函数是指一段可以直接被另一段程序调用的程序或代码。





## `字符串函数`





| 函数                                  | 描述                                                         | 实例                                                         |
| :------------------------------------ | :----------------------------------------------------------- | :----------------------------------------------------------- |
| ASCII(s)                              | 返回字符串 s 的第一个字符的 ASCII 码。                       | 返回 CustomerName 字段第一个字母的 ASCII 码：`SELECT ASCII(CustomerName) AS NumCodeOfFirstChar FROM Customers;` |
| CHAR_LENGTH(s)                        | 返回字符串 s 的字符数                                        | 返回字符串 RUNOOB 的字符数`SELECT CHAR_LENGTH("RUNOOB") AS LengthOfString;` |
| CHARACTER_LENGTH(s)                   | 返回字符串 s 的字符数，等同于 CHAR_LENGTH(s)                 | 返回字符串 RUNOOB 的字符数`SELECT CHARACTER_LENGTH("RUNOOB") AS LengthOfString;` |
| CONCAT(s1,s2...sn)                    | 字符串 s1,s2 等多个字符串合并为一个字符串                    | 合并多个字符串`SELECT CONCAT("SQL ", "Runoob ", "Gooogle ", "Facebook") AS ConcatenatedString;` |
| CONCAT_WS(x, s1,s2...sn)              | 同 CONCAT(s1,s2,...) 函数，但是每个字符串之间要加上 x，x 可以是分隔符 | 合并多个字符串，并添加分隔符：`SELECT CONCAT_WS("-", "SQL", "Tutorial", "is", "fun!")AS ConcatenatedString;` |
| FIELD(s,s1,s2...)                     | 返回第一个字符串 s 在字符串列表(s1,s2...)中的位置            | 返回字符串 c 在列表值中的位置：`SELECT FIELD("c", "a", "b", "c", "d", "e");` |
| FIND_IN_SET(s1,s2)                    | 返回在字符串s2中与s1匹配的字符串的位置                       | 返回字符串 c 在指定字符串中的位置：`SELECT FIND_IN_SET("c", "a,b,c,d,e");` |
| FORMAT(x,n)                           | 函数可以将数字 x 进行格式化 "#,###.##", 将 x 保留到小数点后 n 位，最后一位四舍五入。 | 格式化数字 "#,###.##" 形式：`SELECT FORMAT(250500.5634, 2);     -- 输出 250,500.56` |
| INSERT(s1,x,len,s2)                   | 字符串 s2 替换 s1 的 x 位置开始长度为 len 的字符串           | 从字符串第一个位置开始的 6 个字符替换为 runoob：`SELECT INSERT("google.com", 1, 6, "runoob");  -- 输出：runoob.com` |
| LOCATE(s1,s)                          | 从字符串 s 中获取 s1 的开始位置                              | 获取 b 在字符串 abc 中的位置：`SELECT LOCATE('st','myteststring');  -- 5`返回字符串 abc 中 b 的位置：`SELECT LOCATE('b', 'abc') -- 2` |
| LCASE(s)                              | 将字符串 s 的所有字母变成小写字母                            | 字符串 RUNOOB 转换为小写：`SELECT LCASE('RUNOOB') -- runoob` |
| LEFT(s,n)                             | 返回字符串 s 的前 n 个字符                                   | 返回字符串 runoob 中的前两个字符：`SELECT LEFT('runoob',2) -- ru` |
| LOWER(s)                              | 将字符串 s 的所有字母变成小写字母                            | 字符串 RUNOOB 转换为小写：`SELECT LOWER('RUNOOB') -- runoob` |
| LPAD(s1,len,s2)                       | 在字符串 s1 的开始处填充字符串 s2，使字符串长度达到 len      | 将字符串 xx 填充到 abc 字符串的开始处：`SELECT LPAD('abc',5,'xx') -- xxabc` |
| LTRIM(s)                              | 去掉字符串 s 开始处的空格                                    | 去掉字符串 RUNOOB开始处的空格：`SELECT LTRIM("    RUNOOB") AS LeftTrimmedString;-- RUNOOB` |
| MID(s,n,len)                          | 从字符串 s 的 n 位置截取长度为 len 的子字符串，同 SUBSTRING(s,n,len) | 从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：`SELECT MID("RUNOOB", 2, 3) AS ExtractString; -- UNO` |
| POSITION(s1 IN s)                     | 从字符串 s 中获取 s1 的开始位置                              | 返回字符串 abc 中 b 的位置：`SELECT POSITION('b' in 'abc') -- 2` |
| REPEAT(s,n)                           | 将字符串 s 重复 n 次                                         | 将字符串 runoob 重复三次：`SELECT REPEAT('runoob',3) -- runoobrunoobrunoob` |
| REPLACE(s,s1,s2)                      | 将字符串 s2 替代字符串 s 中的字符串 s1                       | 将字符串 abc 中的字符 a 替换为字符 x：`SELECT REPLACE('abc','a','x') --xbc` |
| REVERSE(s)                            | 将字符串s的顺序反过来                                        | 将字符串 abc 的顺序反过来：`SELECT REVERSE('abc') -- cba`    |
| RIGHT(s,n)                            | 返回字符串 s 的后 n 个字符                                   | 返回字符串 runoob 的后两个字符：`SELECT RIGHT('runoob',2) -- ob` |
| RPAD(s1,len,s2)                       | 在字符串 s1 的结尾处添加字符串 s2，使字符串的长度达到 len    | 将字符串 xx 填充到 abc 字符串的结尾处：`SELECT RPAD('abc',5,'xx') -- abcxx` |
| RTRIM(s)                              | 去掉字符串 s 结尾处的空格                                    | 去掉字符串 RUNOOB 的末尾空格：`SELECT RTRIM("RUNOOB     ") AS RightTrimmedString;   -- RUNOOB` |
| SPACE(n)                              | 返回 n 个空格                                                | 返回 10 个空格：`SELECT SPACE(10);`                          |
| STRCMP(s1,s2)                         | 比较字符串 s1 和 s2，如果 s1 与 s2 相等返回 0 ，如果 s1>s2 返回 1，如果 s1<s2 返回 -1 | 比较字符串：`SELECT STRCMP("runoob", "runoob");  -- 0`       |
| SUBSTR(s, start, length)              | 从字符串 s 的 start 位置截取长度为 length 的子字符串         | 从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：`SELECT SUBSTR("RUNOOB", 2, 3) AS ExtractString; -- UNO` |
| SUBSTRING(s, start, length)           | 从字符串 s 的 start 位置截取长度为 length 的子字符串，等同于 SUBSTR(s, start, length) | 从字符串 RUNOOB 中的第 2 个位置截取 3个 字符：`SELECT SUBSTRING("RUNOOB", 2, 3) AS ExtractString; -- UNO` |
| SUBSTRING_INDEX(s, delimiter, number) | 返回从字符串 s 的第 number 个出现的分隔符 delimiter 之后的子串。 如果 number 是正数，返回第 number 个字符左边的字符串。 如果 number 是负数，返回第(number 的绝对值(从右边数))个字符右边的字符串。 | `SELECT SUBSTRING_INDEX('a*b','*',1) -- a SELECT SUBSTRING_INDEX('a*b','*',-1)  -- b SELECT SUBSTRING_INDEX(SUBSTRING_INDEX('a*b*c*d*e','*',3),'*',-1)  -- c` |
| TRIM(s)                               | 去掉字符串 s 开始和结尾处的空格                              | 去掉字符串 RUNOOB 的首尾空格：`SELECT TRIM('    RUNOOB    ') AS TrimmedString;` |
| UCASE(s)                              | 将字符串转换为大写                                           | 将字符串 runoob 转换为大写：`SELECT UCASE("runoob"); -- RUNOOB` |
| UPPER(s)                              | 将字符串转换为大写                                           | 将字符串 runoob 转换为大写：`SELECT UPPER("runoob"); -- RUNOOB` |







## `数值函数`



| 函数名                             | 描述                                                         | 实例                                                         |
| :--------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| ABS(x)                             | 返回 x 的绝对值                                              | 返回 -1 的绝对值：`SELECT ABS(-1) -- 返回1`                  |
| ACOS(x)                            | 求 x 的反余弦值（单位为弧度），x 为一个数值                  | `SELECT ACOS(0.25);`                                         |
| ASIN(x)                            | 求反正弦值（单位为弧度），x 为一个数值                       | `SELECT ASIN(0.25);`                                         |
| ATAN(x)                            | 求反正切值（单位为弧度），x 为一个数值                       | `SELECT ATAN(2.5);`                                          |
| ATAN2(n, m)                        | 求反正切值（单位为弧度）                                     | `SELECT ATAN2(-0.8, 2);`                                     |
| AVG(expression)                    | 返回一个表达式的平均值，expression 是一个字段                | 返回 Products 表中Price 字段的平均值：`SELECT AVG(Price) AS AveragePrice FROM Products;` |
| CEIL(x)                            | 返回大于或等于 x 的最小整数                                  | `SELECT CEIL(1.5) -- 返回2`                                  |
| CEILING(x)                         | 返回大于或等于 x 的最小整数                                  | `SELECT CEILING(1.5); -- 返回2`                              |
| COS(x)                             | 求余弦值(参数是弧度)                                         | `SELECT COS(2);`                                             |
| COT(x)                             | 求余切值(参数是弧度)                                         | `SELECT COT(6);`                                             |
| COUNT(expression)                  | 返回查询的记录总数，expression 参数是一个字段或者 * 号       | 返回 Products 表中 products 字段总共有多少条记录：`SELECT COUNT(ProductID) AS NumberOfProducts FROM Products;` |
| DEGREES(x)                         | 将弧度转换为角度                                             | `SELECT DEGREES(3.1415926535898) -- 180`                     |
| n DIV m                            | 整除，n 为被除数，m 为除数                                   | 计算 10 除于 5：`SELECT 10 DIV 5;  -- 2`                     |
| EXP(x)                             | 返回 e 的 x 次方                                             | 计算 e 的三次方：`SELECT EXP(3) -- 20.085536923188`          |
| FLOOR(x)                           | 返回小于或等于 x 的最大整数                                  | 小于或等于 1.5 的整数：`SELECT FLOOR(1.5) -- 返回1`          |
| GREATEST(expr1, expr2, expr3, ...) | 返回列表中的最大值                                           | 返回以下数字列表中的最大值：`SELECT GREATEST(3, 12, 34, 8, 25); -- 34`返回以下字符串列表中的最大值：`SELECT GREATEST("Google", "Runoob", "Apple");   -- Runoob` |
| LEAST(expr1, expr2, expr3, ...)    | 返回列表中的最小值                                           | 返回以下数字列表中的最小值：`SELECT LEAST(3, 12, 34, 8, 25); -- 3`返回以下字符串列表中的最小值：`SELECT LEAST("Google", "Runoob", "Apple");   -- Apple` |
| LN                                 | 返回数字的自然对数，以 e 为底。                              | 返回 2 的自然对数：`SELECT LN(2);  -- 0.6931471805599453`    |
| LOG(x) 或 LOG(base, x)             | 返回自然对数(以 e 为底的对数)，如果带有 base 参数，则 base 为指定带底数。 | `SELECT LOG(20.085536923188) -- 3 SELECT LOG(2, 4); -- 2`    |
| LOG10(x)                           | 返回以 10 为底的对数                                         | `SELECT LOG10(100) -- 2`                                     |
| LOG2(x)                            | 返回以 2 为底的对数                                          | 返回以 2 为底 6 的对数：`SELECT LOG2(6);  -- 2.584962500721156` |
| MAX(expression)                    | 返回字段 expression 中的最大值                               | 返回数据表 Products 中字段 Price 的最大值：`SELECT MAX(Price) AS LargestPrice FROM Products;` |
| MIN(expression)                    | 返回字段 expression 中的最小值                               | 返回数据表 Products 中字段 Price 的最小值：`SELECT MIN(Price) AS MinPrice FROM Products;` |
| MOD(x,y)                           | 返回 x 除以 y 以后的余数                                     | 5 除于 2 的余数：`SELECT MOD(5,2) -- 1`                      |
| PI()                               | 返回圆周率(3.141593）                                        | `SELECT PI() --3.141593`                                     |
| POW(x,y)                           | 返回 x 的 y 次方                                             | 2 的 3 次方：`SELECT POW(2,3) -- 8`                          |
| POWER(x,y)                         | 返回 x 的 y 次方                                             | 2 的 3 次方：`SELECT POWER(2,3) -- 8`                        |
| RADIANS(x)                         | 将角度转换为弧度                                             | 180 度转换为弧度：`SELECT RADIANS(180) -- 3.1415926535898`   |
| RAND()                             | 返回 0 到 1 的随机数                                         | `SELECT RAND() --0.93099315644334`                           |
| ROUND(x [,y])                      | 返回离 x 最近的整数，可选参数 y 表示要四舍五入的小数位数，如果省略，则返回整数。 | `SELECT ROUND(1.23456) --1 SELECT ROUND(345.156, 2) -- 345.16` |
| SIGN(x)                            | 返回 x 的符号，x 是负数、0、正数分别返回 -1、0 和 1          | `SELECT SIGN(-10) -- (-1)`                                   |
| SIN(x)                             | 求正弦值(参数是弧度)                                         | `SELECT SIN(RADIANS(30)) -- 0.5`                             |
| SQRT(x)                            | 返回x的平方根                                                | 25 的平方根：`SELECT SQRT(25) -- 5`                          |
| SUM(expression)                    | 返回指定字段的总和                                           | 计算 OrderDetails 表中字段 Quantity 的总和：`SELECT SUM(Quantity) AS TotalItemsOrdered FROM OrderDetails;` |
| TAN(x)                             | 求正切值(参数是弧度)                                         | `SELECT TAN(1.75);  -- -5.52037992250933`                    |
| TRUNCATE(x,y)                      | 返回数值 x 保留到小数点后 y 位的值（与 ROUND 最大的区别是不会进行四舍五入） | `SELECT TRUNCATE(1.23456,3) -- 1.234`                        |







## `日期函数`



| 函数                              | 功能                                              |
| --------------------------------- | ------------------------------------------------- |
| curdate()                         | 返回当前日期                                      |
| curtime()                         | 返回当前时间                                      |
| now()                             | 返回当前日期和时间                                |
| year(date)                        | 获取指定date的年份                                |
| month(date)                       | 获取指定date的月份                                |
| day(date)                         | 获取指定date的日期                                |
| date_add(date,interval expr type) | 返回一个日期/时间值加上一个时间间隔expr后的时间值 |
| datediff(date1,date2)             | 返回起始时间date1和结束时间date2之间的天数        |







## `流程函数`





| 函数名                                                       | 描述                                                         | 实例                                                         |
| :----------------------------------------------------------- | :----------------------------------------------------------- | :----------------------------------------------------------- |
| BIN(x)                                                       | 返回 x 的二进制编码                                          | 15 的 2 进制编码:`SELECT BIN(15); -- 1111`                   |
| BINARY(s)                                                    | 将字符串 s 转换为二进制字符串                                | `SELECT BINARY "RUNOOB"; -> RUNOOB`                          |
| `CASE expression    WHEN condition1 THEN result1    WHEN condition2 THEN result2   ...    WHEN conditionN THEN resultN    ELSE result END` | CASE 表示函数开始，END 表示函数结束。如果 condition1 成立，则返回 result1, 如果 condition2 成立，则返回 result2，当全部不成立则返回 result，而当有一个成立之后，后面的就不执行了。 | `SELECT CASE  　WHEN 1 > 0 　THEN '1 > 0' 　WHEN 2 > 0 　THEN '2 > 0' 　ELSE '3 > 0' 　END ->1 > 0` |
| CAST(x AS type)                                              | 转换数据类型                                                 | 字符串日期转换为日期：`SELECT CAST("2017-08-29" AS DATE); -> 2017-08-29` |
| COALESCE(expr1, expr2, ...., expr_n)                         | 返回参数中的第一个非空表达式（从左向右）                     | `SELECT COALESCE(NULL, NULL, NULL, 'runoob.com', NULL, 'google.com'); -> runoob.com` |
| CONNECTION_ID()                                              | 返回唯一的连接 ID                                            | `SELECT CONNECTION_ID(); -> 4292835`                         |
| CONV(x,f1,f2)                                                | 返回 f1 进制数变成 f2 进制数                                 | `SELECT CONV(15, 10, 2); -> 1111`                            |
| CONVERT(s USING cs)                                          | 函数将字符串 s 的字符集变成 cs                               | `SELECT CHARSET('ABC') ->utf-8     SELECT CHARSET(CONVERT('ABC' USING gbk)) ->gbk` |
| CURRENT_USER()                                               | 返回当前用户                                                 | `SELECT CURRENT_USER(); -> guest@%`                          |
| DATABASE()                                                   | 返回当前数据库名                                             | `SELECT DATABASE();    -> runoob`                            |
| IF(expr,v1,v2)                                               | 如果表达式 expr 成立，返回结果 v1；否则，返回结果 v2。       | `SELECT IF(1 > 0,'正确','错误')     ->正确`                  |
| [IFNULL(v1,v2)](https://www.runoob.com/mysql/mysql-func-ifnull.html) | 如果 v1 的值不为 NULL，则返回 v1，否则返回 v2。              | `SELECT IFNULL(null,'Hello Word') ->Hello Word`              |
| ISNULL(expression)                                           | 判断表达式是否为 NULL                                        | `SELECT ISNULL(NULL); ->1`                                   |
| LAST_INSERT_ID()                                             | 返回最近生成的 AUTO_INCREMENT 值                             | `SELECT LAST_INSERT_ID(); ->6`                               |
| NULLIF(expr1, expr2)                                         | 比较两个字符串，如果字符串 expr1 与 expr2 相等 返回 NULL，否则返回 expr1 | `SELECT NULLIF(25, 25); ->`                                  |
| SESSION_USER()                                               | 返回当前用户                                                 | `SELECT SESSION_USER(); -> guest@%`                          |
| SYSTEM_USER()                                                | 返回当前用户                                                 | `SELECT SYSTEM_USER(); -> guest@%`                           |
| USER()                                                       | 返回当前用户                                                 | `SELECT USER(); -> guest@%`                                  |
| VERSION()                                                    | 返回数据库的版本号                                           | `SELECT VERSION() -> 5.6.34`                                 |









# 约束



概念：

> 约束是作用于表中字段上的规则，用于限制存储在表中的数据。



目的：

> 保证数据库中的数据正确、有效性和完整性。



分类：

| 约束                       | 描述                                                     | 关键字                           |
| -------------------------- | -------------------------------------------------------- | -------------------------------- |
| 非空约束                   | 限制该字段的数据不能为null                               | not null                         |
| 唯一约束                   | 保证该字段的所有数据都是唯一、不重复的                   | unique                           |
| 主键约束                   | 主键是一行数据的唯一标识，要求非空且唯一                 | primary key， **AUTO_INCREMENT** |
| 默认约束                   | 保存数据时，如果未指定该字段的值，则采用默认值           | default                          |
| 检查约束（8.0.16版本之后） | 保证字段值满足某一条件                                   | check                            |
| 外键约束                   | 用来让两张表的数据之间建立连接，保证数据的一致性和完整性 | foreign key                      |

**AUTO_INCREMENT** (主键自增)

注意：

​			约束是作用于表中字段上的，可以在创建表/修改表的时候添加约束。









## `外键约束`



### `添加外键`



语法1：

```mysql
create table 表名(
	字段名 数据类型,
    ...
    [constraint] [外键名称] foreign key(外键字段名) references 主表(主表列名)
);
```



添加外键语法2:

```mysql
alter table 表名 add constraint 外键名称  foreign key(外键字段名) references 主表(主表列名);
```

constraint:	限制



实例：

```mysql
alter table emp add constraint fk_emp_dept_id  foreign key(dept_id) references dept(id);
```





### `删除外键`



```mysql
alter table 表名 drop foreign key 外键名称;
```







### `删除/更新行为`



|    行为     |                             说明                             |
| :---------: | :----------------------------------------------------------: |
|  NO ACTION  | 当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。(与RESTRICT一致) |
|  RESTRICT   | 当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除/更新。(与NO ACTION一致) |
|   CASCADE   | 当在父表中删除/更新对应记录时，首先检查该记录是否有对应外键，如果有，则也删除/更新外键在子表中的记录。 |
|  SET NULL   | 当在父表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null(这就要求该外键允许取null)。 |
| SET DEFAULT |  父表有变更时，子表将外键列设置成一个默认的值(Innodb不支持)  |



```mysql
ALTER TABLE表名ADDCONSTRAINT外键名称FOREIGN KEY(外键字段)REFERENCES主表名(主表字段名） ONUPDATE CASCADE ONDELETE CASCADE;
```







# 多表查询



## 多表关系



概述：

项目开发中，在进行数据库表结构设计时，会根据业务需求及业务模块之间的关系，分析并设计表结构，由于业务之间相互关联，所以各个表结构之间也存在着各种联系，基本上分为三种:

●	一对多(多对一)

​	在多的一方建立外键，指向一的一方的主键

●	多对多

​	建立第三张中间表，中间表至少包含两个外键，分别关联两方主键

●	一对一

关系:一对一关系，多用于单表拆分，将一张表的基础字段放在一张表中，其他详情字段放在另一张表中，以提升操作效率

实现:在任意一方加入外键，关联另外一方的主键，`并且设置外键为唯一的(UNIQUE)`







## 多表查询



概述:指从多张表中查询数据

笛卡尔积:笛卡尔乘积是指在数学中，两个集合A集合和B集合的所有组合情况。(在多表查询时，需要消除无效的笛卡尔积)









## 多表查询分类

`连接查询`:

​				`内连接`:相当于查询A、B交集部分数据

​				`外连接`:

​							`左外连接`:查询左表所有数据，以及两张表交集部分数据

​							`右外连接`:查询右表所有数据，以及两张表交集部分数据

​				`自连接`:当前表与自身的连接查询，自连接必须使用表别名

`子查询`







## 连接查询





### `内连接`



内连接查询语法:

> 隐式内连接:

```mysql
SELECT  字段列表   FROM 表1,表2 WHERE 条件...;
```

> 显式内连接:	

```mysql
SELECT 字段列表   FROM 表1 [INNER]  JOIN 表2 ON  连接条件...;
```

内连接查询的是两张表交集的部分





### `外连接`



外连接查询语法:

> 左外连接:相当于查询表1(左表)的所有数据包含表1和表2交集部分的数据

```mysql
SELECT 字段列表 FROM表1 LEFT [OUTER] JOIN 表2 ON 条件...;
```



> 右外连接:相当于查询表2(右表)的所有数据包含表1和表2交集部分的数据

```mysql
SELECT 字段列表 FROM表1 RIGHT [OUTER] JOIN 表2 ON 条件....;
```









### `自连接`

> 自连接查询语法:

```mysql
SELECT 字段列表 FROM 表A 别名A JOIN 表A 别名B ON 条件...;
```

自连接查询，可以是内连接查询，也可以是外连接查询。











## 联合查询-union , union all

> 对于union查询，就是把多次查询的结果合并起来，形成一个新的查询结果集。

```mysql
SELECT 字段列表 FROM 表A ....
UNION [ALL]
SELECT 字段列表 FROM 表B.....;
```



`注意：`

> 对于联合查询的多张表的列数必须保持一致，字段类型也需要保持一致。
>
> union all 会将全部的数据直接合并在一起，union会对合并之后的数据去重。











## 子查询



> 概念:	SQL语句中嵌套SELECT语句，称为嵌套查询，又称子查询。
>
> 子查询外部的语句可以是`INSERT / UPDATE /DELETE/SELECT`的任何一个。

```mysql
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2);
```



> 根据子查询结果不同，分为:
>
> ●	标量子查询（子查询结果为单个值)
>
> ●	列子查询(子查询结果为一列)
>
> ●	行子查询(子查询结果为一行)
>
> ●	表子查询(子查询结果为多行多列)



> 根据子查询位置，分为: WHERE之后、FROM之后、SELECT之后。l









### `标量子查询`

> 子查询返回的结果是单个值（数字、字符串、日期等），最简单的形式，这种子查询称为`标量子查询`。
>
> 常用的操作符:	`= <> > >= < <=`







### `列子查询`

> 子查询返回的结果是一列（可以是多行)，这种子查询称为列子查询。
>
> 常用的操作符:IN 、NOT IN 、ANY 、SOME 、ALL



| 操作符 | 描述                                   |
| ------ | -------------------------------------- |
| IN     | 在指定的集合范围之内，多选一           |
| NOT IN | 不在指定的集合范围之内                 |
| ANY    | 子查询返回列表中，有任意一个满足即可   |
| SOME   | 与ANY等同，使用SOME的地方都可以使用ANY |
| ALL    | 子查询返回列表的所有值都必须满足       |









### `行子查询`

> 子查询返回的结果是一行（可以是多列)，这种子查询称为行子查询。
>
> 常用的操作符:= 、<、IN、NOT IN







### `表子查询`

> 子查询返回的结果是多行多列，这种子查询称为表子查询。
>
> 常用的操作符:IN











# 事务



## 事务简介

> 事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作要么同时成功，要么同时失败。





## 事务步骤

> 1.开启事务
>
> 2.如果抛出异常，回滚事务
>
> 3.提交事务

默认MySQL的事务是自动提交的。也就是说，当执行一条DML语句，MySQL会立即隐式的提交事务。









## 事务操作



### `开启事务`

方法1：

> `查看事务提交方式`。1为自动提交，0为手动提交，默认是自动提交

```mysql
SELECT @@autocommit;
```



> 设置事务提交方式

```mysql
SET @@autocommit = 0;
```



方法2：

```mysql
START TRANSACTION或 BEGIN;
```



### `提交事务`

```mysql
COMMIT;
```



### `回滚事务`

```mysql
ROLLBACK;
```











## 事务的四大特性(ACID)



> ●	原子性（`A`tomicity)∶事务是不可分割的最小操作单元，要么全部成功，要么全部失败。
>
> ●	一致性（`C`onsistency)∶事务完成时，必须使所有的数据都保持一致状态。
>
> ●	隔离性（`I`solation):数据库系统提供的隔离机制，保证事务在不受外部并发操作影响的独立环境下运行。
>
> ●	持久性（`D`urability):事务一旦提交或回滚，它对数据库中的数据的改变就是永久的。













## 并发事务问题



| 问题       | 描述                                                         |
| ---------- | ------------------------------------------------------------ |
| 脏读       | 一个事务读到另外一个事务还没有提交的数据。                   |
| 不可重复读 | 一个事务先后读取同一条记录，但两次读取的数据不同，称之为不可重复读。 |
| 幻读       | 一个事务按照条件查询数据时，没有对应的数据行，但是在插入数据时，又发现这行数据已经存在，好像出现了"幻影"。 |

















## 事务隔离级别



|       隔离级别        | 赃读 | 不可重复读 | 幻读 |
| :-------------------: | :--: | :--------: | :--: |
|   Read uncommitted    |  √   |     √      |  √   |
|    Read committed     |  x   |     √      |  √   |
| Repeatable Read(默认) |  x   |     x      |  √   |
|     Serializable      |  x   |     x      |  x   |



> 查看事务隔离级别

```mysql
SELECT @@TRANSACTION_ISOLATION;
```



> 设置事务隔离级别
>
> SESSION:	会话级别，针对当前客户端窗口有效
>
> GLOBAL:	 针对所有的客户端会话窗口有效

```mysql
SET [SESSION|GLOBAL] TRANSACTION ISOLATION LEVEL {READ UNCOMMITTED |READ COMMITTED |REPEATABLE READ | SERIALIZABLE}
```



------

------

------





# MySQL进阶

# 存储引擎





## MySQL体系结构

![image-20230321103514562](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20230321103514562.png)





> 连接层:	最上层是一些客户端和链接服务，主要完成一些类似于连接处理、授权认证、及相关的安全方案。服务器也会为安全接入的每个客户端验证它所具有的操作权限。
>
> 服务层:	第二层架构主要完成大多数的核心服务功能，如SQL接口，并完成缓存的查询，SQL的分析和优化，部分内置函数的执行。所有跨存储引擎的功能也在这一层实现，如过程、函数等。
>
> 引擎层:	存储引擎真正的负责了MySQL中数据的存储和提取，服务器通过API和存储引擎进行通信。不同的存储引擎具有不同的功能，这样我们可以根据自己的需要，来选取合适的存储引擎。
>
> 存储层:	主要是将数据存储在文件系统之上，并完成与存储引擎的交互。







## 存储引擎简介



> 存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被称为表类型。







## 指定存储引擎

`1.在创建表时，指定存储引擎`

注意:	如果没有指定存储引擎，默认指定innodb引擎

```mysql
CREATE TABLE表名(
		字段1 字段1类型[ COMMENT 字段1注释]，
		...
		字段n 字段n类型[COMMENT 字段n注释]
		)ENGINE= ININODB [COMMENT 表注释];
```



`2.查看当前数据库支持的存储引擎`

```mysql
SHOW ENGINES;
```









## 存储引擎特点



| 特点         | lnnoDB            | MyISAM | Memory |
| ------------ | ----------------- | ------ | ------ |
| 存储限制     | 64TB              | 有     | 有     |
| 事务安全     | 支持              | -      | -      |
| 锁机制       | 行锁              | 表锁   | 表锁   |
| B+tree索引   | 支持              | 支持   | 支持   |
| Hash索引     | -                 | -      | 支持   |
| 全文索引     | 支持(5.6版本之后) | 支持   | -      |
| 空间使用     | 高                | 低     | N/A    |
| 内存使用     | 高                | 低     | 中等   |
| 批量插入速度 | 低                | 高     | 高     |
| 支持外键     | 支持              | -      | -      |







### `●	lnnoDB`

> 介绍:	InnoDB是一种兼顾高可靠性和高性能的通用存储引擎，在MySQL 5.5之后，InnoDB是默认的MySQL存储引擎。
>
> 特点:
>
> ​			●	DML操作遵循ACID模型，支持`事务`;
>
> ​			●	`行级锁`，提高并发访问性能;
>
> ​			●	支持`外键`FOREIGN KEY约束，保证数据的完整性和正确性;



文件

> xxx.ibd: xxx代表的是表名，innoDB引擎的每张表都会对应这样一个表空间文件，存储该表的表结构(frm、sdi)、数据和索引。参数: innodb_file_per_table





注意:	最小单位是Page,它的大小是16k，extent的大小是1M，它等于64个Page

![image-20230321110325686](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20230321110325686.png)











### `●	MyISAM`



> 介绍:	MylSAM是MySQL早期的默认存储引擎。
>
> 特点:
>
> ​			●	不支持事务，不支持外键
>
> ​			●	支持表锁，不支持行锁
>
> ​			●	访问速度快
>
> 文件:
>
> ​			●	xxx.sdi:存储表结构信息
>
> ​			●	xxx.MYD:存储数据
>
> ​			●	xxx.MYI:存储索引







### `●	Memory`

> 介绍:	Memory引擎的表数据时存储在内存中的，由于受到硬件问题、或断电问题的影响，只能将这些表作为临时表或缓存使用。
>
> 特点:	
>
> ​			●	内存存放
>
> ​			●	hash索引（默认)
>
> 文件:
>
> ​			●	xxx.sdi:存储表结构信息









## 存储引擎选择

`在选择存储引擎时，应该根据应用系统的特点选择合适的存储引擎。对于复杂的应用系统,还可以根据实际情况选择多种存储引擎进行组`

> InnoDB:是MySQL的默认存储引擎，支持事务、外键。如果应用对事务的完整性有比较高的要求，在并发条件下要求数据的一致性，数据操作除了插入和查询之外，还包含很多的更新、删除操作，那么InnoDB存储引擎是比较合适的选择。
>
> MyISAM:如果应用是以读操作和插入操作为主，只有很少的更新和删除操作，并且对事务的完整性、并发性要求不是很高，那么选择这个存储引擎是非常合适的。
>
> MEMORY:将所有数据保存在内存中，访问速度快，通常用于临时表及缓存。MEMORY的缺陷就是对表的大小有限制，太大的表无法缓存在内存中,而且无法保障数据的安全性。











# MySQL8.0.26-Linux版下载和配置





## 1. 准备一台Linux服务器

云服务器或者虚拟机都可以; 

Linux的版本为 CentOS7;



## 2. 下载Linux版MySQL安装包

https://downloads.mysql.com/archives/community/

![image-20211031230239760](D:\2023\heima_JAVA\2022_heima_MySQL数据库\进阶篇\进阶篇\MySQL安装文档-Linux\assets\image-20211031230239760.png) 



## 3. 上传MySQL安装包

![image-20211031231930205](D:\2023\heima_JAVA\2022_heima_MySQL数据库\进阶篇\进阶篇\MySQL安装文档-Linux\assets\image-20211031231930205.png) 



## 4. 解压压缩包

```
tar -xvf mysql-8.0.26-1.el7.x86_64.rpm-bundle.tar -C mysql
```



## 5.创建mysql目录并进入目录

```
mkdir mysql

cd mysql
```



## 6.安装mysql的配置包



```
rpm -ivh mysql-community-common-8.0.26-1.el7.x86_64.rpm 

rpm -ivh mysql-community-client-plugins-8.0.26-1.el7.x86_64.rpm 

rpm -ivh mysql-community-libs-8.0.26-1.el7.x86_64.rpm 

rpm -ivh mysql-community-libs-compat-8.0.26-1.el7.x86_64.rpm

rpm -ivh  mysql-community-devel-8.0.26-1.el7.x86_64.rpm

rpm -ivh mysql-community-client-8.0.26-1.el7.x86_64.rpm

rpm -ivh  mysql-community-server-8.0.26-1.el7.x86_64.rpm

```

`注意可能出现的错误`：

错误1：

```
错误：can't create 事务 lock on /var/lib/rpm/.rpm.lock (权限不够)
```

```
解决办法:进入root(超级管理员)
su root
输入超级管理员密码
```

错误2：

```
错误：mariadb-libs 被 mysql-community-libs-8.0.26-1.el7.x86_64 取代
```

```
解决办法：rpm -e mariadb-libs --nodeps
```

错误3：

```
错误：pkgconfig(openssl) 被 mysql-community-devel-8.0.26-1.el7.x86_64 需要
```

```
解决办法：yum install openssl-devel
一直输入y回车
```







## 7. 启动MySQL服务

启动

```
systemctl start mysqld
```

重启

```
systemctl restart mysqld
```

停止

```
systemctl stop mysqld
```



## 8. 查询自动生成的root用户密码

```
grep 'temporary password' /var/log/mysqld.log

注意：密码是随机生成的
root@localhost:后面的就是随机生成的密码

A temporary password is generated for root@localhost: dw+pBs/Jf5:#
```

命令行执行指令 :

```
mysql -u root -p
```

然后输入上述查询到的自动生成的密码, 完成登录 .

注意:	这里如果登录不成功可以重启MySQL然后再登录



## 9. 修改root用户密码

登录到MySQL之后，需要将自动生成的不便记忆的密码修改了，修改成自己熟悉的便于记忆的密码。

```
ALTER  USER  'root'@'localhost'  IDENTIFIED BY '1234';
```

执行上述的SQL会报错，原因是因为设置的密码太简单，密码复杂度不够。我们可以设置密码的复杂度为简单类型，密码长度为4。

注意：

set global validate_password.policy = 0;	指的是密码复杂类型，0是最低等级

set global validate_password.length = 4;	指的是密码的长度	

```
set global validate_password.policy = 0;
set global validate_password.length = 4;
```

降低密码的校验规则之后，再次执行上述修改密码的指令。



## 10. 创建用户

默认的root用户只能当前节点localhost访问，是无法远程访问的，我们还需要创建一个root账户，用户远程访问

```
create user 'root'@'%' IDENTIFIED WITH mysql_native_password BY '1234';
```



## 11. 并给root用户分配权限

```
grant all on *.* to 'root'@'%';
```



## 12. 重新连接MySQL

```
mysql -u root -p
```

然后输入密码





## 13.通过DataGrip远程连接Linux系统的MySQL

`注意如果没有开发Linux的3306端口是连接不上的`

### **步骤如下：**

1、在VMware Workstation启动linux系统；

2、打开linux系统的防火墙：应用程序->杂项->防火墙；

3、在[防火墙配置](https://so.csdn.net/so/search?q=防火墙配置&spm=1001.2101.3001.7020)中：选择public->端口->添加->端口/端口范围输入3306；协议选择tcp->确定；





![img](https://img-blog.csdnimg.cn/4739eaa97147498994374c80c58dc7f2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA54yr5omT55CD5ZWG5bqX,size_20,color_FFFFFF,t_70,g_se,x_16)







4、在linux终端中输入: ifconfig -a，找到linux的IP地址，复制该IP地址；

![img](https://img-blog.csdnimg.cn/8179bcddfdfb496d860fd6abf4292b6f.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA54yr5omT55CD5ZWG5bqX,size_20,color_FFFFFF,t_70,g_se,x_16)





5、打开DataGrip，按图片中依次点击：

![img](https://img-blog.csdnimg.cn/fe31b117893849b9987473667e88882a.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA54yr5omT55CD5ZWG5bqX,size_20,color_FFFFFF,t_70,g_se,x_16)





6、将下图中红框部分换成第4步中找到的IP地址，并且在User和Password中分别输入linux中MySQL的用户名和密码；

![img](https://img-blog.csdnimg.cn/bf4eccdb82c746f19db224f881938355.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA54yr5omT55CD5ZWG5bqX,size_20,color_FFFFFF,t_70,g_se,x_16)

![img](https://img-blog.csdnimg.cn/074c79eb438b4e6d94f6824ef4216892.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA54yr5omT55CD5ZWG5bqX,size_20,color_FFFFFF,t_70,g_se,x_16)





7、填写完毕后，点击Test Connection，如果出现绿色的对勾，说明连接成功了。



![img](https://img-blog.csdnimg.cn/8cadb8b703e94ad89037738b287e1b63.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA54yr5omT55CD5ZWG5bqX,size_20,color_FFFFFF,t_70,g_se,x_16)













# MySQL8.0.26-Linux版卸载

停止MySQL服务

```
systemctl stop mysqld
```



查询MySQL的安装文件

```
rpm -qa | grep -i mysql
```

![image-20211031233522877](D:\2023\heima_JAVA\2022_heima_MySQL数据库\进阶篇\进阶篇\MySQL卸载文档-Linux\assets\image-20211031233522877.png) 



卸载上述查询出来的所有的MySQL安装包

```
rpm -e mysql-community-client-plugins-8.0.26-1.el7.x86_64 --nodeps

rpm -e mysql-community-server-8.0.26-1.el7.x86_64 --nodeps

rpm -e mysql-community-common-8.0.26-1.el7.x86_64 --nodeps

rpm -e mysql-community-libs-8.0.26-1.el7.x86_64 --nodeps

rpm -e mysql-community-client-8.0.26-1.el7.x86_64 --nodeps

rpm -e mysql-community-libs-compat-8.0.26-1.el7.x86_64 --nodeps
```



删除MySQL的数据存放目录

```
rm -rf /var/lib/mysql/
```



删除MySQL的配置文件备份

```
rm -rf /etc/my.cnf.rpmsave
```























# 索引



介绍:

> 索引(index)是帮助MySQL`高效获取数据的数据结构(有序)`。在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法，这种数据结构就是索引。



优缺点:

| 优势                                                         | 劣势                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 提高数据检索的效率，降低数据库的IO成本                       | 索引列也是要占用空间的。                                     |
| 通过索引列对数据进行排序，降低数据排序的成本，降低CPU的消耗。 | 索引大大提高了查询效率，同时却也降低更新表的速度，如对表进行INSERT、UPDATE、DELETE时，效率降低。 |







## 索引结构



> MySQL的索引是在存储引擎层实现的，不同的存储引擎有不同的结构，主要包含以下几种:

| 索引结构            | 描述                                                         |
| ------------------- | ------------------------------------------------------------ |
| B+Tree索引          | `最常见的索引类型，大部分引擎都支持B+树索引`                 |
| Hash索引            | 底层数据结构是用哈希表实现的,只有精确匹配索引列的查询才有效,不支持范围查询 |
| R-tree(空间索引)    | 空间索引是MylSAM引擎的一个特殊索引类型，主要用于地理空间数据类型，通常使用较少 |
| Full-text(全文索引) | 是一种通过建立倒排索引,快速匹配文档的方式。类似于Lucene,Solr,ES |



| 索引       | lnnoDB          | MylSAM | Memory |
| ---------- | --------------- | ------ | ------ |
| B+tree索引 | 支持            | 支持   | 支持   |
| Hash 索引  | 不支持          | 不支持 | 支持   |
| R-tree索引 | 不支持          | 支持   | 不支持 |
| Full-text  | 5.6版本之后支持 | 支持   | 不支持 |

`我们平常所说的索引，如果没有特别指明，都是指B+树结构组织的索引。`







## 二叉树



`二叉树缺点∶顺序插入时，会形成一个链表，查询性能大大降低。大数据量情况下，层级较深，检索速度慢。`



### B-Tree

![image-20230322110017634](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20230322110017634.png)



`一个父节点两个子节点，左边子节点的比父节点小，右边的子节点比父节点大`

`注意：每个节点最多存储4个key，5个指针。以一颗max-degree(最大度数)为5阶的b-tree为例，它最多有5个子节点，5个子节点就有5个指针，有5个子节点就有4个key`。

> 这里的key(20,30,,62,89)
>
> 超过5阶会发生裂变，叫中间元素向上分裂
>
> 数据图形显示网站:	http://www.rmboot.com/







### B+Tree

![image-20230322113122442](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20230322113122442.png)

> 特点：
>
> ​			●	存储数据的是叶子节点
>
> ​			●	所有的数据都会出现在叶子节点
>
> ​			●	存储数据的叶子节点是一个单向链表结构



> MySQL索引数据结构对经典的B+Tree进行了优化。在原B+Tree的基础上，增加一个指向相邻叶子节点的链表指针，就形成了带有顺序指针的B+Tree，提高区间访问的性能。





## Hash

简介：

> 哈希索引就是采用一定的hash算法，将键值换算成新的hash值，映射到对应的槽位上，然后存储在hash表中。
>
> 如果两个(或多个)键值，映射到一个相同的槽位上，他们就产生了hash冲突（也称为hash碰撞〉，可以通过链表来解决。



### Hash索引的特点

> 1. Hash索引只能用于对等比较(=，in)，不支持范围查询（between， >,<,...)
>
> 2. 无法利用索引完成排序操作
>
> 3. 查询效率高，通常只需要一次检索就可以了，效率通常要高于B+tree索引
>
>    
>
>    ●	存储引擎支持
>
>    在MySQL中，支持hash索引的是Memory引擎，而InnoDB中具有自适应hash功能，hash索引是存储引擎根据B+ Tree索引在指定条件下自动构建的。





## 为什么InnoDB存储引擎选择使用B+tree索引结构?

> 相对于二叉树，层级更少，搜索效率高;
>
> 对于B-tree，无论是叶子节点还是非叶子节点，都会保存数据，这样导致一页中存储的键值减少，指针跟着减少，要同样保存大量数据，只能增加树的高度，导致性能降低;
>
> 相对Hash索引，B+tree支持范围匹配及排序操作;











## 索引分类



| 分类     | 含义                                                 | 特点                    | 关键字   |
| -------- | ---------------------------------------------------- | ----------------------- | -------- |
| 主键索引 | 针对于表中主键创建的索引                             | 默认自动创建,只能有一个 | PRIMARY  |
| 唯一索引 | 避免同一个表中某数据列中的值重复                     | 可以有多个              | UNIQUE   |
| 常规索引 | 快速定位特定数据                                     | 可以有多个              |          |
| 全文索引 | 全文索引查找的是文本中的关键词，而不是比较索引中的值 | 可以有多个              | FULLTEXT |



在lnnoDB存储引擎中，根据索引的存储形式，又可以分为以下两种:

| 分类                      | 含义                                                       | 特点                |
| ------------------------- | ---------------------------------------------------------- | ------------------- |
| 聚集索引(Clustered Index) | 将数据存储与索引放到了一块，索引结构的叶子节点保存了行数据 | 必须有,而且只有一个 |
| 二级索引(Secondary Index) | 将数据与索引分开存储，索引结构的叶子节点关联的是对应的主键 | 可以存在多个        |



`聚集索引选取规则:`

> 如果存在主键，主键索引就是聚集索引。
>
> 如果不存在主键，将使用第一个唯一（UNIQUE）索引作为聚集索引。
>
> 如果表没有主键，或没有合适的唯一索引，则InnoDB会自动生成一个rowid作为隐藏的聚集索引。



------



`聚集索引:	存储的是一行数据`

`二级索引:	存储的是对应行数据的id值`

`回表查询：先通过查询二级索引的id值，在回到聚合索引根据id值来查询行数据`



![image-20230322185940072](C:\Users\86158\AppData\Roaming\Typora\typora-user-images\image-20230322185940072.png)

















## 索引语法



创建索引

```mysql
CREATE [UNIQUE|FULLTEXT] INDEX index_name ON table_name ( index_col_nam....);
```



查看索引

```mysql
SHOW INDEX FROM table_name;
```



删除索引

```mysql
DROP INDEX index_name ON table_name;
```

